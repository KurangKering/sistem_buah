{% extends "base.html" %}
{% load static %}
{% block export-css %}
<!-- DataTables -->
<link rel="stylesheet" href="{% static "plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" %}">
<link rel="stylesheet" href="{% static "plugins/datatables-responsive/css/responsive.bootstrap4.min.css" %}">
<link rel="stylesheet" href="{% static "plugins/cropperjs/dist/cropper.min.css" %}">
{% endblock export-css %}
{% block css %}
<style type="text/css">
img {
  display: block;
  max-width: 100%;
}
.preview {
  overflow: hidden;
  width: 160px; 
  height: 160px;
  margin: 10px;
  border: 1px solid red;
}
.modal-lg{
  max-width: 1000px !important;
}

</style>
{% endblock css %}
{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0 text-dark">Tambah Model Baru</h1>
      </div><!-- /.col -->
      <div class="col-sm-6 text-right">
      </div><!-- /.col -->
    </div><!-- /.row -->
  </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card" id="content-menu">

          <!-- /.card-header -->
          <div class="card-body">

            <form id="form-latih" onsubmit="return false;">
              {% csrf_token %}

              <div class="form-group">
                <label for="">Simpan Model</label>
                <select name="simpan" id="simpan" class="form-control">
                  <option value="1">Ya</option>
                  <option value="-1">Tidak</option>
                </select>
              </div>
              <div class="form-group">
                <label for="">Pembagian Data Uji (%)</label>
                <input type="text" class="form-control" id="persen_uji" required placeholder="ex: 20 artinya 80% data latih dan 20% data uji " name="persen_uji" value="20">
              </div>
              <div class="form-group">
                <label for="">Epoch</label>
                <input type="number" class="form-control" id="epoch" name="epoch" value="1">
              </div>
              
              
              <button class="btn btn-primary" type="submit" id="btn-latih">Mulai Latih</button>
            </form>
            
          </div>
          <!-- /.card-body -->
        </div>
        <div style="display:none" id="content-hasil-klasifikasi">
          <div class="card">
            <div class="card-header">
              Hasil Pemrosesan
            </div>
            <!-- /.card-header -->
            <div class="card-body">
              <div class="table-responsive">
                <table class="table ">
                  <tbody>
                    <tr>
                      <th style="width:40%">Epoch</th>
                      <td>: <span id="epoch-show"></span></td>
                    </tr>
                    <tr>
                      <th>Jumlah Benar (Akurasi)</th>
                      <td>: <span id="jumlah_benar"></span> dari <span id="total_data_test"></span> (<span id="akurasi"></span> %)</td>
                    </tr>


                  </tbody></table>
                </div>


              </div>
              <!-- /.card-body -->
            </div>
          </div>

          <div style="display:none" id="content-data-latih">
            <div class="card">
              <div class="card-header">
                Data Latih
              </div>
              <!-- /.card-header -->
              <div class="card-body">

                <table class="table table-striped nowrap" id="table-data-latih">
                  <thead>
                    <tr>
                      <th>NO</th>
                      <th>MEAN H</th>
                      <th>MEAN S</th>
                      <th>MEAN V</th>
                      <th>ASPECT_RATIO</th>
                      <th>FORM_FACTOR</th>
                      <th>RECT</th>
                      <th>NARROW_FACTOR</th>
                      <th>PRD</th>
                      <th>PLW</th>
                      <th>KELAS</th>
                    </tr>
                  </thead>
                  <tbody>

                  </tbody>

                </table>

              </div>
              <!-- /.card-body -->
            </div>
          </div>

          <div style="display:none" id="content-data-uji">
            <div class="card">
              <div class="card-header">
                Data Uji
              </div>
              <!-- /.card-header -->
              <div class="card-body">

                <table class="table table-striped nowrap" id="table-data-uji">
                  <thead>
                    <tr>
                      <th>NO</th>
                      <th>MEAN H</th>
                      <th>MEAN S</th>
                      <th>MEAN V</th>
                      <th>ASPECT_RATIO</th>
                      <th>FORM_FACTOR</th>
                      <th>RECT</th>
                      <th>NARROW_FACTOR</th>
                      <th>PRD</th>
                      <th>PLW</th>
                      <th>KELAS</th>
                      <th>Kelas Prediksi</th>
                      <th>Citra Prediksi</th>
                    </tr>
                  </thead>

                </table>

              </div>
              <!-- /.card-body -->
            </div>
          </div>

          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
    </div><!-- /.container-fluid -->
  </section>

  <!-- /.content -->





  {% endblock content %}

  {% block export-js %}
  <!-- DataTables -->
  <script src="{% static "plugins/datatables/jquery.dataTables.min.js" %}"></script>
  <script src="{% static "plugins/datatables-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
  <script src="{% static "plugins/datatables-responsive/js/dataTables.responsive.min.js" %}"></script>
  <script src="{% static "plugins/datatables-responsive/js/responsive.bootstrap4.min.js" %}"></script>
  {% endblock export-js %}

  {% block js %}

  <script>
  var urlStatic = {% static "" %};
  var tableDataLatih = $("#table-data-latih").DataTable({
    "scrollX": true,
    "columns": [
    { "data": "nomor" },
    { "data": "mean_h" },
    { "data": "mean_s" },
    { "data": "mean_v" },
    { "data": "aspect_ratio" },
    { "data": "form_factor" },
    { "data": "rect" },
    { "data": "narrow_factor" },
    { "data": "prd" },
    { "data": "plw" },
    { "data": "kelas" },
    ],
    pageLength: 5,

    order : [],
  });
  var tableDataUji = $("#table-data-uji").DataTable({
    "scrollX": true,
    "columns": [
    { "data": "nomor" },
    { "data": "mean_h" },
    { "data": "mean_s" },
    { "data": "mean_v" },
    { "data": "aspect_ratio" },
    { "data": "form_factor" },
    { "data": "rect" },
    { "data": "narrow_factor" },
    { "data": "prd" },
    { "data": "plw" },
    { "data": "kelas" },
    { "data": "kelas_predicted" },
    { 
      "data": "citra_prediksi",
      "render": function(data, type, row, meta) {
        if (data == null) {
          return "";
        }
        return '<img src="'+urlStatic+data+'" alt="">';
      }
    },
    ],
    pageLength: 5,

    order : [],
  });

  $("#form-latih").submit(function(e) {
    e.preventDefault();
    var overlayContent = overlaySelector.content.cloneNode(true);
    $("#content-menu").append(overlayContent);
    hideContent();
    var URL = "{% url 'buah/proses_pelatihan' %}";
    var data = new FormData($(this)[0]);
    axios.post(URL, data)
    .then((res) => {
      data = res.data;
      console.log(data);
      tableDataLatih.clear();
      tableDataLatih.rows.add(data.table_train);
      tableDataLatih.draw();

      tableDataUji.clear();
      tableDataUji.rows.add(data.table_test);
      tableDataUji.draw();


      $("#epoch-show").text(data.epoch);
      $("#jumlah_benar").text(data.jumlah_benar);
      $("#total_data_test").text(data.total_data_test);
      $("#akurasi").text(data.akurasi);

      $("html, body").animate({scrollTop: $("#content-menu").offset().top});
    })
    .catch(() => {

    })
    .then(() => {
      showContent();
      $("#content-menu").find(".overlay").remove();

    })
  });

  function hideContent() {
    tableDataLatih.clear();
    tableDataLatih.draw();

    tableDataUji.clear();
    tableDataUji.draw();
    $("#epoch-show").text("");
    $("#jumlah_benar").text("");
    $("#total_data_test").text("");
    $("#akurasi").text("");
    $("#content-data-latih").hide();
    $("#content-data-uji").hide();
    $("#content-hasil-klasifikasi").hide();
  }
  function showContent() {
   $("#content-data-latih").show();
   $("#content-data-uji").show();
   $("#content-hasil-klasifikasi").show();
 }

 </script>
 {% endblock js %}