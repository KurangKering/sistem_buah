{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>Sistem Klasifikasi Buah</title>
  <link rel="icon" type="image/x-icon" href="{% static 'grayscale/assets/img/favicon.ico' %}" />
  <!-- Font Awesome icons (free version)-->
  <script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js" crossorigin="anonymous"></script>
  <!-- Google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="{% static 'plugins/iziModal-1.5.1/css/iziModal.min.css' %}" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-select/css/select.bootstrap4.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-buttons/css/buttons.bootstrap4.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/sweetalert2/sweetalert2.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/spinjs/spin.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/cropperjs/dist/cropper.min.css' %}">
  <link href="{% static 'grayscale/css/styles.css' %}" rel="stylesheet" />
  <style>
  .signup-section {
    padding: 10rem 0;
    background: linear-gradient(to bottom, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.5) 75%, #000000 100%), url("{% static 'frontend/img/bg-upload.jpg' %}");
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: scroll;
    background-size: cover;
  }

  .center-image-card:hover {
    border: 1px solid;
  }

  .center-image-card {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 200px;
    height: 300px;
  }
  .swal2-container {
    z-index: 999999 !important;
  }

  .text-hasil-pengujian {
    text-align: center;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 36px;
  }

  .citra-prediksi {
   margin-top: 0 ;
   margin-bottom: 15px ;
   display: block;
   margin-left: auto;
   margin-right: auto;
   width: 200px;
   height: 300px;
 }

 .citra-prediksi-label {
  text-transform: uppercase;
  text-align: center;
  font-weight: bolder;
  font-size: 26px;
}
</style>
</head>

<body id="page-top">
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">Home</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#about">About</a></li>
          <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#buah">Buah Gaharu</a></li>
          <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#klasifikasi">Klasifikasi</a></li>
          <li class="nav-item"><a class="nav-link js-scroll-trigger" href="{% url 'login' %}">Login</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Masthead-->
  <header class="masthead">
    <div class="container d-flex h-100 align-items-center">
      <div class="mx-auto text-center">
        <h1 class="mx-auto my-0 text-uppercase">GAHARU</h1>
        <a class="btn btn-primary js-scroll-trigger mt-5" href="#klasifikasi">Mulai Klasifikasi</a>
      </div>
    </div>
  </header>
  <!-- About-->
  <section class="about-section text-center" id="about">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2 class="text-white mb-4">Apa itu Sistem Pengenalan Daun Buah ?</h2>
          <p class="text-white-50">
            Pengenalan Daun Buah ini adalah sebuah sistem yang ditujukan kepada masyarakat umum yang ingin mengenal jenis daun buah lebih dalam. Sistem ini dapat membedakan atau mengklasifikasikan jenis-jenis dari daun buah. Pada saat ini sistem hanya dapat mengklasifikasikan 4 jenis daun buah yang berada di riau, yaitu Buah <i>Crassna , Micropcarpa , Sinensis , dan Subintegra </i>
          </p>
        </div>
      </div>
    </div>
  </section>
  <!-- Projects-->
  <section class="projects-section" id="buah" style="background-color: #e7e7e7">
    <div class="container">
      <!-- Featured Project Row-->
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2 class="mb-4 text-center">GAHARU</h2>
        </div>
      </div>
      <div class="row shadow justify-content-center no-gutters mb-5 mb-lg-0 align-items-center mt-5" style="height: 350px;">
        <div class="col-xl-2 col-lg-7">
          <img class="img-fluid img-thumbnail" src="{% static 'frontend/Crassna.jpg' %}" alt="responsive image" style="height: 250px; ">
        </div>
        <div class="col-xl-7">
          <div class="featured-text text-center text-lg-left">
            <h3>Crassna</h3>
            <p class="text-black-50 mb-0"> Buah jenis crassna ini memiliki bentuk daun Daun lonjong - lanset, (8-) 18-24 cm x (4,5-)2-3 cm, licin, ujung daun lancip, pangkal tumpul, tulang daun sekunder sejajar/paralel, jumlah 23-32 pasang, terlihat jelas pada permukaan bawah. Persebarannya terdapat pada wilayah Maluku (Buru: Kajeli dan Halmaheira), Riau (Sumatera).</p>
          </div>
        </div>
      </div>
      <div class="row bg-black justify-content-center rounded-lg no-gutters mt-5 mb-5 mb-lg-0 align-items-center" style="padding-left: 100px; height: 350px;">
        <div class="col-lg-8">
          <div class="bg-black text-center h-100 project">
            <div class="d-flex h-100">
              <div class="project-text w-100 my-auto text-center text-lg-left">
                <h4 class="text-white">Subintegra</h4>
                <p class="mb-0 text-white-50">Buah Subintegra adalah jenis baru yang memiliki kualitas tinggi hasil perkawinan buah crassna dengan buah malacensis. Daun ini ditemukan di Thailand. Daunnya memiliki bentuk bundar telur melebar-lonjong berkuran 12-16cm x 6-9cm.
                </p>
                <hr class="d-none d-lg-block mb-0 ml-0">
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <img class="img-fluid img-thumbnail" src="{% static 'frontend/Subintegra.jpg' %}" alt="responsive image" style="height: 250px; ">
        </div>
      </div>
      <div class="row  justify-content-center shadow no-gutters mb-5 mb-lg-0 align-items-center mt-5" style="height: 350px;">
        <div class="col-xl-2 col-lg-7">
          <img class="img-fluid img-thumbnail" src="{% static 'frontend/Sinensis.jpg' %}" alt="responsive image" style="height: 250px; ">
        </div>
        <div class="col-xl-7">
          <div class="featured-text text-center text-lg-left">
            <h3>Sinensis</h3>
            <p class="text-black-50 mb-0">Buah sinensis adalah spesies tanaman endemik yang ditemukan di cina. Bentuk daun buah sinensis ini bundar telur melonjong dengan tekstur yang kasar pada bagian pertulangan dan halus pada permukaan daunnya. Daun buah sinensis ini umumnya memiliki panjang 5-12cm x lebar 3-6cm. Persebaran buah jenis sinensis ini terdapat di wilayah sumatera, kalimantan dan dataran cina.</p>
          </div>
        </div>
      </div>
      <div class="row bg-black align-items-center no-gutters mb-4 mb-lg-5 mt-5 rounded-lg" style="height: 350px;">
        <div class="col-xl-7">
          <div class="text-center  text-lg-right">
            <h4 class="text-white">Microcarpa</h4>
            <p class="text-white-50 mb-0"> Buah jenis microcarpa memiliki nama daerah karas (Indonesia). Daunnya memiliki bentuk Daun bundar telur-lanset terbalik, tipis, ukuran 4-11 x 1–4 cm, ujung lancip, pangkal daun bentuk pasak-tirus, tepi rata dan menebal; warna hijau, permukaan atas licin, bawah kadang berbulu halus, panjang tangkai 3-5 mm, tulang daun sekunder sejajar, agak rapat, jumlah 10–19 pasang, terlihat jelas menonjol pada permukaan bawah. Persebaran buah microcarpa ini terdapat pada wilayah Sumatera (Sijunjung, Lampung, Palembang, Riau, Bengkulu, Jambi, Bangka dan Belitung)dan Kalimantan.
            </p>
            <hr class="d-none d-lg-block mb-0 ml-0">
          </div>
        </div>
        <div class="col-xl-5 col-lg-5" style="padding-left: 100px;">
          <img class=" img-fluid mb-3 mb-lg-2 img-thumbnail" src="{% static 'frontend/Microcarpa.jpg' %}" alt="responsive image" style="height: 250px; ">
        </div>
      </div>
    </div>
  </section>
  <!-- Signup-->
  <section class="signup-section" id="klasifikasi">
    <div class="container">
      <div class="row mb-5 text-center text-white">
        <div class="col-lg-10 mx-auto">
          <h1 class="display-4">KLASIFIKASI DAUN GAHARU</h1>
          <p class="lead">Silahkan Upload Citra Daun Buah</p>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-5 mx-auto">
          <div class="p-5 bg-white shadow rounded-lg">
            <img src="https://res.cloudinary.com/mhmd/image/upload/v1557366994/img_epm3iz.png" alt="" width="200" class="d-block mx-auto mb-4 rounded-pill">
            <h6 class="text-center mb-4 text-muted">
              Baca Dahulu aturan sebelum Proses Ekstraksi Citra
            </h6>
            <div align="center">
              <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#exampleModalCenter">
                Read Me !
              </button>
            </div>
            <br>
            <div class="custom-file overflow-hidden rounded-pill mb-5">
              <input id="input-image" name="input-image" type="file" class="custom-file-input rounded-pill" name="image" accept="image/*">
              <label for="customFile" id="avatar" class="custom-file-label rounded-pill">Choose file</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Contact-->
  <!-- Footer-->
  <footer class="footer bg-black small text-center text-white-50">
    <div class="container">Copyright © ADITYA PAM BUDHI - 11451104750</div>
  </footer>
  <div id="modal-large" data-iziModal-fullscreen="true">
    <div class="row">
      <div class="col-6">
        <div class="card">
          <div class="card-header">
            <div class="callout callout-info">
              <h5><i class="fas fa-info-circle"></i> Note:</h5>
              Pilih salah satu model dibawah ini untuk digunakan pada pengujian.
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table id="table-model-anfis" class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th>No</th>
                    <th>Data Latih</th>
                    <th>Data Uji</th>
                    <th>Epoch</th>
                    <th>Akurasi</th>
                  </tr>
                </thead>
                <tbody>
                  {% for model in models %}
                  <tr data-model-id="{{ model.id }}">
                    <td>{{ forloop.counter }}</td>
                    <td>{{ model.jumlah_data_latih }}</td>
                    <td>{{ model.jumlah_data_uji }}</td>
                    <td>{{ model.epoch }}</td>
                    <td>{{ model.accuracy }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card shadow">
          <div class="card-header">
            <div class="callout callout-info">
              <h5><i class="fas fa-info-circle"></i> Note:</h5>
              Crop Data sesuaikan dengan keinginan. <b>-Ratio 2:3-</b>
            </div>
          </div>
          <div class="card-body">
            <div class="img-container">
              <img id="image" style="width: 100%; height:600px" src="{% static 'images/empty-images.png' %}" />
            </div>
          </div>
          <div class="card-footer">
            <button id="btn-klasifikasi" class="btn btn-info btn-block">Mulai Klasifikasi</button>
          </div>
        </div>
      </div>
    </div>
    <div id="content-hasil" class="mt-2" style="display:none">
      <div class="row ">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <p class="text-hasil-pengujian">Hasil Pengujian</p>
              <div id="place-result-here">
                <div>
                  <center>
                    <img style="display:none" src="{% static "citra-kelas/subintegra.jpg" %}" alt="" class="citra-prediksi">
                  </center>
                  <p style="display:none" class="citra-prediksi-label"></p>
                </div>

              </div>
              
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-4">
          <div class="card">
            <div class="card-body">
              <img class="center-image-card" id="image-clean" src="{% static 'images/Crassna (1).jpg' %}" alt="">
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="card">
            <div class="card-body">
              <img class="center-image-card" id="image-gray" src="{% static 'images/Crassna (1)-gray.jpg' %}" alt="">
            </div>
          </div>
        </div>
        <div class="col-4">
          <div class="card">
            <div class="card-body">
              <img class="center-image-card" id="image-binary" src="{% static 'images/Crassna (1)-cleaned.jpg' %}" alt="">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% csrf_token %}
  <!-- Bootstrap core JS-->
  <script src="{% static 'grayscale/js/jquery-3.5.1.min.js' %}"></script>
  <script src="{% static 'grayscale/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'grayscale/jquery.easing/jquery.easing.min.js' %}"></script>
  <!-- DataTables -->
  <script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-select/js/dataTables.select.min.js' %}"></script>
  <script src="{% static 'plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
  <script src="{% static 'plugins/cropperjs/dist/cropper.min.js' %}"></script>
  <script src="{% static 'plugins/spinjs/spin.umd.js' %}"></script>
  <script src="{% static 'plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
  <script src="{% static 'plugins/iziModal-1.5.1/js/iziModal.min.js' %}"></script>
  <!-- Core theme JS-->
  <script src="{% static 'grayscale/js/scripts.js' %}"></script>
  <script src="{% static 'custom.js' %}"></script>
  <script>
  var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]');
  
  $("#modal-large").iziModal({
    history: false,
    title: "Klasifikasi",
    icon: 'icon-chat',
    iconColor: 'white',
    width: 700,
    padding: 20,
    bodyOverflow: true,
    openFullscreen: true,
    onClosed: function(modal) {
      history.replaceState(null, "", window.location.pathname)
    },
    onOpening: function(modal) {
      modal.startLoading();
    },
    onOpened: function(modal) {
      modal.stopLoading();
      setTimeout(function() {
        $("#modal-large .iziModal-wrap").scrollTop(0);
      }, 1)
    }
  });
  $("#modal-large").iziModal('setZindex', 99999);

  var objModelId = { model_id: null };
  var model_id = null;
  var $inputImg = $("input[name='input-image']");
  var image = $("#image");
  var $btnKlasifikasi = $("#btn-klasifikasi");
  var urlStatic = "{% static "" %}";

  var filename;
  var cropper;

  setModelTableSelector('#table-model-anfis', objModelId);

  var actionsOnReadImage = {
    inputElement: null,
    failedValidate: function() {

    },
    successValidate: function() {
      $("#modal-large").iziModal("open");
      $("#content-hasil").hide();
      if (cropper) {
        cropper.destroy();
        cropper = null;
      }
    },
    finished: function() {
      cropper = new Cropper(image[0], {
        strict: true,
        viewMode: 2,
        cropBoxResizable: false,
        aspectRatio: 2 / 3,
        autoCropArea: 0.7,
        cropBoxMovable: true,
        dragMode: 'none',
        center: true,
        zoomOnWheel: false,
      });
    },
  };

  var actionsOnSendCroppedImage = {
    element: null,
    startSend: function(canvas) {
      canvas.toBlob(function(blob) {
        let reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = function() {
         var base64data = reader.result;
         $.ajax({
          headers: { 'X-CSRFToken': csrftoken.value },
          type: "POST",
          dataType: "json",
          url: "{% url 'process_pengujian' %}",
          data: { image: base64data, model_id: objModelId.model_id },
          beforeSend: function() {
            $("#modal-large").iziModal("startLoading");
            $("#content-hasil").hide();

          }
        })
         .done(function(result) {
          if (result.success == 1) {
            $(".citra-prediksi-label").text(result.kelas_hasil).show();
            if (result.citra_prediksi != null) {
             $(".citra-prediksi").attr("src", urlStatic+result.citra_prediksi).show();
           }

           $("#image-clean").attr("src", "data:image/png;base64," + (result.image_clean));
           $("#image-gray").attr("src", "data:image/png;base64," + (result.image_gray));
           $("#image-binary").attr("src", "data:image/png;base64," + (result.image_binary));

           $("#content-hasil").show();
           var element = document.getElementById("content-hasil")
           element.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' })
         }
       })
         .always(function() {
          $("#modal-large").iziModal("stopLoading");
        })
       }
     });
    }
  };

  $inputImg.change(function(e) {
    actionsOnReadImage.event = e;
    readImageFromInput(actionsOnReadImage);
  });

  $btnKlasifikasi.click(function(event) {
    if (!validateNoNullVar(objModelId.model_id)) {
      swalFireGagal();
      return;
    }
    if (cropper) {
      actionsOnSendCroppedImage.element = cropper;
      sendCroppedImageToServer(actionsOnSendCroppedImage);
    }

  });
  </script>
</body>

</html>